cmake_minimum_required(VERSION 3.0)

set(CMAKE_INCLUDE_CURRENT_DIR ON)

include(ExternalProject)

if(NOT EMSCRIPTEN)
    include("cmake/HunterGate.cmake")
    HunterGate(
        URL "https://github.com/ruslo/hunter/archive/v0.19.26.tar.gz"
        SHA1 "362b3c2fd8f0f50fc03cec5105be8fd4376ea886"
    )
endif()

project(MutCube)

if(EMSCRIPTEN)
    set(CMAKE_EXECUTABLE_SUFFIX ".html")
    set(CMAKE_C_FLAGS   "-s USE_SDL=2 -s TOTAL_MEMORY=134217728 ${CMAKE_C_FLAGS}")
    set(CMAKE_CXX_FLAGS "-s USE_SDL=2 -s TOTAL_MEMORY=134217728 ${CMAKE_CXX_FLAGS}")
    set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -s USE_SDL=2 -s TOTAL_MEMORY=134217728 --preload-file assets")

    include(ExternalProject)
    ExternalProject_Add(
        glm
        PREFIX ${CMAKE_BINARY_DIR}/glm
        GIT_REPOSITORY https://github.com/g-truc/glm.git
        GIT_TAG 0.9.8.4
        CONFIGURE_COMMAND ""
        BUILD_COMMAND ""
        INSTALL_COMMAND ""
        LOG_DOWNLOAD ON)
    ExternalProject_Get_Property(glm source_dir)
    include_directories(${source_dir})

else()
    hunter_add_package(SDL2)
    hunter_add_package(glm)
    find_package(SDL2 CONFIG REQUIRED)
    find_package(glm CONFIG REQUIRED)
endif()


add_executable(MutCube
    assets/texture.png
    assets/shader.frag
    assets/shader.vert
    MutEngine.cpp
    MutEngine.h
    MutGL.c # Generated by GLBrebis
    MutGL.h # Generated by GLBrebis
    MutShaderProgram.cpp
    MutShaderProgram.h
    stb_image.h
    main.cpp
)

add_dependencies(MutCube glm)

configure_file(${MutCube_SOURCE_DIR}/assets/texture.png
               ${MutCube_BINARY_DIR}/assets/texture.png COPYONLY)

configure_file(${MutCube_SOURCE_DIR}/assets/shader.vert
               ${MutCube_BINARY_DIR}/assets/shader.vert COPYONLY)

configure_file(${MutCube_SOURCE_DIR}/assets/shader.frag
               ${MutCube_BINARY_DIR}/assets/shader.frag COPYONLY)

if(NOT EMSCRIPTEN)
    target_link_libraries(MutCube
        SDL2::SDL2 glm
    )
endif()
